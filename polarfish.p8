pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

-- playing 
playing = false
-- score
score = 0
-- timer
timer = 0
-- timer_decay - time (seconds) for each timer tick (e.g. .25)
timer_decay = 0.1
-- last - last timer event
last = 0

-- player_x, player_y

-- fish_x, fish_y
-- fish_vx, fish_vy
-- fish_value - timer points for catching fish
fish_value = 60

function create_fish()	
	fish_x = flr(rnd(120))
	fish_y = flr(rnd(120))
	fish_vx = rnd(3) - 1
 	fish_vy = rnd(3) - 1
end

function eat_fish() 
	sfx(0)
	score = score + 1
	timer = timer + fish_value

	fish_value = fish_value - 1
	if (fish_value < 15) then 
		fish_value = 15 
	end
end

function collision_check()
	dpx = abs(player_x - fish_x) + abs(player_y - fish_y)
	if (dpx < 4) then 
		eat_fish()
		create_fish()
  	end
end

function game_over()
	playing = false
	sfx(1)
end

function update_timer()
	now = time()
	elapsed = abs(now - last)
	if (elapsed >= timer_decay) then
		timer = timer - 1
		if (timer <= 0) then
			game_over()
		end
		last = now
	end
end

function update_player()
	if (btn(0)) then player_x = player_x - 1 end
	if (btn(1)) then player_x = player_x + 1 end
  	if (player_x < 0) then player_x = 0 end
  	if (player_x > 120) then player_x = 120 end

 	if (btn(2)) then player_y = player_y - 1 end
  	if (btn(3)) then player_y = player_y + 1 end  
	if (player_y < 0) then player_y = 0 end
	if (player_y > 120) then player_y = 120 end  
end

function update_fish()
	fish_x = (fish_x + fish_vx) % 120
	fish_y = (fish_y + fish_vy) % 120  
end

function start_game()
	sfx(2)
	score = 0
	fish_value = 60
	timer = fish_value * 2

	playing = true
	create_fish()
end

function _init()
	player_x = 64
	player_y = 64
	playing = false
end

function _update()
  	if (playing) then
		update_player()
		update_fish()
    	collision_check()
    	update_timer()
  	elseif (btn(5)) then
    	start_game()
  	end
end

function draw_hud()
	-- fish value left
	print(fish_value, 0, 0, 7)

	if (playing) then
		-- score centered
		score_x = 64 - (#tostr(score) / 2)
		print(score, score_x, 0, 7)
	else
		-- game over
 		print("game over - press x", 30, 0, 7)
	end

	-- timer right
	timer_x = 120 - #tostr(timer)
	print(timer, timer_x, 0, 7)
end

function _draw()
	cls()
	map(0,0,0,0,16,16)
	spr(1, player_x, player_y)
	spr(2, fish_x, fish_y)
	draw_hud()
end

__gfx__
00000000055555550000000077777777111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000557777750000100177677677111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777770111c11c77777777111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770005777777510ccccc077767777111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700005777775c111110077777777111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700057555751cccccc077777777111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000057505750111c11c76777767111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055505550000100177777777111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404030303030303030303030303040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030303030303030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030303030303030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030303030303030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030404040303030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030304040403030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030404040403030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030304040403030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030304040403030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030303030303030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030303030303030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030303030303030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0403030303030303030303030303030400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404030303030303030303030303040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000100502f0503005030050320502e0503205032050310502f0502b050250501b0501b0501d0501e0501f0502105024050270502b0502e05000000000000000000000000000000000000000000000000000
0010000036450334502e45029450234501b4501145007450024500145000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100000000001755018550195501b5501c550000001f550215500000023550000002655028550295502a5502c5502d5502f55030550000000000000000000000000000000000000000000000000000000000000
__music__
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434441
00 42434400
00 00000000

